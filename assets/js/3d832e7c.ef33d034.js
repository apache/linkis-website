"use strict";(self.webpackChunklinkis_web_apache=self.webpackChunklinkis_web_apache||[]).push([[76810],{3905:(e,t,a)=>{a.d(t,{Zo:()=>c,kt:()=>h});var n=a(67294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function o(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function s(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},o=Object.keys(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var l=n.createContext({}),u=function(e){var t=n.useContext(l),a=t;return e&&(a="function"==typeof e?e(t):i(i({},t),e)),a},c=function(e){var t=u(e.components);return n.createElement(l.Provider,{value:t},e.children)},d="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},p=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,o=e.originalType,l=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),d=u(a),p=r,h=d["".concat(l,".").concat(p)]||d[p]||m[p]||o;return a?n.createElement(h,i(i({ref:t},c),{},{components:a})):n.createElement(h,i({ref:t},c))}));function h(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=a.length,i=new Array(o);i[0]=p;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s[d]="string"==typeof e?e:r,i[1]=s;for(var u=2;u<o;u++)i[u]=a[u];return n.createElement.apply(null,i)}return n.createElement.apply(null,a)}p.displayName="MDXCreateElement"},84993:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>l,contentTitle:()=>i,default:()=>m,frontMatter:()=>o,metadata:()=>s,toc:()=>u});var n=a(87462),r=(a(67294),a(3905));const o={title:"Data Source Manual",sidebar_position:4},i=void 0,s={unversionedId:"user-guide/datasource-manual",id:"version-1.4.0/user-guide/datasource-manual",title:"Data Source Manual",description:"Introduce how to use the new feature function data source of version 1.1.0",source:"@site/versioned_docs/version-1.4.0/user-guide/datasource-manual.md",sourceDirName:"user-guide",slug:"/user-guide/datasource-manual",permalink:"/docs/latest/user-guide/datasource-manual",draft:!1,editUrl:"https://github.com/apache/linkis-website/edit/dev/versioned_docs/version-1.4.0/user-guide/datasource-manual.md",tags:[],version:"1.4.0",sidebarPosition:4,frontMatter:{title:"Data Source Manual",sidebar_position:4},sidebar:"tutorialSidebar",previous:{title:"Linkis SDK Manual",permalink:"/docs/latest/user-guide/sdk-manual"},next:{title:"UDF Function",permalink:"/docs/latest/user-guide/udf-function"}},l={},u=[{value:"1. Data source function introduction",id:"1-data-source-function-introduction",level:2},{value:"1.1 Concept",id:"11-concept",level:3},{value:"1.2 Three main modules",id:"12-three-main-modules",level:3},{value:"1.3 Processing logic",id:"13-processing-logic",level:3},{value:"1.3.1 LinkisDataSourceRemoteClient",id:"131-linkisdatasourceremoteclient",level:4},{value:"1.3.2 LinkisMetaDataRemoteClient",id:"132-linkismetadataremoteclient",level:4},{value:"1.3 Source module directory structure",id:"13-source-module-directory-structure",level:3},{value:"1.4 Installation package directory structure",id:"14-installation-package-directory-structure",level:3},{value:"1.5 Configuration Parameters",id:"15-configuration-parameters",level:3},{value:"1.6 Installation extra data drivers",id:"16-installation-extra-data-drivers",level:3},{value:"2. Enable data source function",id:"2-enable-data-source-function",level:2},{value:"3. Use of data sources",id:"3-use-of-data-sources",level:2},{value:"3.1 Mysql data source",id:"31-mysql-data-source",level:3},{value:"3.1.1 Created through the management console",id:"311-created-through-the-management-console",level:4},{value:"3.1.2 Using the client",id:"312-using-the-client",level:4},{value:"3.1.3 JDBC EngineConn supported by Linkis",id:"313-jdbc-engineconn-supported-by-linkis",level:4},{value:"3.2 Hive data source",id:"32-hive-data-source",level:3},{value:"3.2.1 Created through the management console",id:"321-created-through-the-management-console",level:4},{value:"3.2.2 Using the client",id:"322-using-the-client",level:4}],c={toc:u},d="wrapper";function m(e){let{components:t,...o}=e;return(0,r.kt)(d,(0,n.Z)({},c,o,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Introduce how to use the new feature function data source of version 1.1.0")),(0,r.kt)("h2",{id:"1-data-source-function-introduction"},"1. Data source function introduction"),(0,r.kt)("h3",{id:"11-concept"},"1.1 Concept"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Data source: We call database services that can provide data storage as databases, such as mysql/hive/kafka. The data source defines the configuration information for connecting to the actual database. The configuration information is mainly the address required for connection and user authentication information , connection parameters, etc. Stored in the linkis",(0,r.kt)("em",{parentName:"li"},"ps_dm_datasource"),"* table related to the linkis database"),(0,r.kt)("li",{parentName:"ul"},"Metadata: simply refers to the metadata of the database, which refers to the data that defines the data structure and the data of various object structures of the database. For example, the database name, table name, column name, field length, type and other information data in the database.")),(0,r.kt)("h3",{id:"12-three-main-modules"},"1.2 Three main modules"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"linkis-datasource-client"),"\nClient module, DataSourceRemoteClient for basic management of user data sources, and MetaDataRemoteClient for metadata query operations."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"linkis-datasource-manager-server"),"\nData source management module, service name ps-data-source-manager. Perform basic management of data sources, and provide http interfaces such as adding, querying, modifying, and connection testing of external data sources. The rpc service is provided internally, which is convenient for the data element management module to call through rpc to query the necessary information needed to establish a connection to the database."),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"/docs/latest/api/http/linkis-ps-publicservice-api/data-source-manager-api"},"http interface documentation")),(0,r.kt)("li",{parentName:"ul"},"http interface class org.apache.linkis.metadatamanager.server.restful"),(0,r.kt)("li",{parentName:"ul"},"rpc interface class org.apache.linkis.metadatamanager.server.receiver")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"linkis-metedata-manager-server"),"\nData element management module, service name ps-metadatamanager. It provides the basic query function of the data metadata of the database, provides the http interface externally, and provides the rpc service internally, which is convenient for the data source management module to perform the connection test of the data source through the rpc call."),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"/docs/latest/api/http/linkis-ps-publicservice-api/metadatamanager-api"},"http interface documentation")),(0,r.kt)("li",{parentName:"ul"},"http interface class org.apache.linkis.datasourcemanager.core.restful"),(0,r.kt)("li",{parentName:"ul"},"rpc interface class org.apache.linkis.datasourcemanager.core.receivers")),(0,r.kt)("h3",{id:"13-processing-logic"},"1.3 Processing logic"),(0,r.kt)("h4",{id:"131-linkisdatasourceremoteclient"},"1.3.1 LinkisDataSourceRemoteClient"),(0,r.kt)("p",null,"The functional structure diagram is as follows:\n",(0,r.kt)("img",{alt:"datasource",src:a(9513).Z,width:"860",height:"661"})),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"The LinkisDataSourceRemoteClient client assembles the http request according to the request parameters,"),(0,r.kt)("li",{parentName:"ul"},"HTTP request sent to linkis-ps-data-source-manager"),(0,r.kt)("li",{parentName:"ul"},"linkis-ps-data-source-manager will perform basic parameter verification, some interfaces can only be operated by the administrator role"),(0,r.kt)("li",{parentName:"ul"},"linkis-ps-data-source-manager performs basic data operations with the database"),(0,r.kt)("li",{parentName:"ul"},"The data source test connection interface provided by linkis-ps-data-source-manager internally uses rpc to call the ps-metadatamanager method for connection test"),(0,r.kt)("li",{parentName:"ul"},"The data result after the http request is processed will be mapped and converted from the result set to the entity class by annotating the DWSHttpMessageResult function")),(0,r.kt)("p",null,"LinkisDataSourceRemoteClient interface"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"GetAllDataSourceTypesResult getAllDataSourceTypes(GetAllDataSourceTypesAction) Query all data source types"),(0,r.kt)("li",{parentName:"ul"},"QueryDataSourceEnvResult queryDataSourceEnv(QueryDataSourceEnvAction) Query the cluster configuration information that can be used by the data source"),(0,r.kt)("li",{parentName:"ul"},"GetInfoByDataSourceIdResult getInfoByDataSourceId(GetInfoByDataSourceIdAction): query data source information by data source id"),(0,r.kt)("li",{parentName:"ul"},"QueryDataSourceResult queryDataSource(QueryDataSourceAction) query data source information"),(0,r.kt)("li",{parentName:"ul"},"GetConnectParamsByDataSourceIdResult getConnectParams(GetConnectParamsByDataSourceIdAction) Get connection configuration parameters"),(0,r.kt)("li",{parentName:"ul"},"CreateDataSourceResult createDataSource(CreateDataSourceAction) to create a data source"),(0,r.kt)("li",{parentName:"ul"},"DataSourceTestConnectResult getDataSourceTestConnect(DataSourceTestConnectAction) to test whether the data source can be connected normally"),(0,r.kt)("li",{parentName:"ul"},"DeleteDataSourceResult deleteDataSource(DeleteDataSourceAction) deletes the data source"),(0,r.kt)("li",{parentName:"ul"},"ExpireDataSourceResult expireDataSource(ExpireDataSourceAction) sets the data source to expired state"),(0,r.kt)("li",{parentName:"ul"},"GetDataSourceVersionsResult getDataSourceVersions(GetDataSourceVersionsAction) Query the version list of the data source configuration"),(0,r.kt)("li",{parentName:"ul"},"PublishDataSourceVersionResult publishDataSourceVersion(PublishDataSourceVersionAction) publishes the data source configuration version"),(0,r.kt)("li",{parentName:"ul"},"UpdateDataSourceResult updateDataSource(UpdateDataSourceAction) to update the data source"),(0,r.kt)("li",{parentName:"ul"},"UpdateDataSourceParameterResult updateDataSourceParameter(UpdateDataSourceParameterAction) Update data source configuration parameters"),(0,r.kt)("li",{parentName:"ul"},"GetKeyTypeDatasourceResult getKeyDefinitionsByType(GetKeyTypeDatasourceAction) Query the configuration properties required by a data source type")),(0,r.kt)("h4",{id:"132-linkismetadataremoteclient"},"1.3.2 LinkisMetaDataRemoteClient"),(0,r.kt)("p",null,"The functional structure diagram is as follows:\n",(0,r.kt)("img",{alt:"metadata",src:a(21470).Z,width:"931",height:"527"})),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"LinkisMetaDataRemoteClient client, according to the request parameters, assemble the http request,"),(0,r.kt)("li",{parentName:"ul"},"HTTP request sent to ps-metadatamanager"),(0,r.kt)("li",{parentName:"ul"},"ps-metadatamanager will perform basic parameter verification,"),(0,r.kt)("li",{parentName:"ul"},"The request will send an RPC request to linkis-ps-data-source-manager based on the parameter datasourceId to obtain the type of the data source, connection parameters such as username and password, etc."),(0,r.kt)("li",{parentName:"ul"},"After getting the information required for the connection, load the lib package in the corresponding directory according to the data source type, and call the corresponding function method through the reflection mechanism to query the metadata information"),(0,r.kt)("li",{parentName:"ul"},"The data result after the http request is processed will be mapped and converted from the result set to the entity class by annotating the DWSHttpMessageResult function")),(0,r.kt)("p",null,"LinkisMetaDataRemoteClient interface"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"MetadataGetDatabasesResult getDatabases(MetadataGetDatabasesAction) query database list"),(0,r.kt)("li",{parentName:"ul"},"MetadataGetTablesResult getTables(MetadataGetTablesAction) query table data"),(0,r.kt)("li",{parentName:"ul"},"MetadataGetTablePropsResult getTableProps(MetadataGetTablePropsAction)"),(0,r.kt)("li",{parentName:"ul"},"MetadataGetPartitionsResult getPartitions(MetadataGetPartitionsAction) query partition table"),(0,r.kt)("li",{parentName:"ul"},"MetadataGetColumnsResult getColumns(MetadataGetColumnsAction) query data table fields")),(0,r.kt)("h3",{id:"13-source-module-directory-structure"},"1.3 Source module directory structure"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell",metastring:"script",script:!0},"linkis-public-enhancements/linkis-datasource\n\n\u251c\u2500\u2500 linkis-datasource-client //client code\n\u251c\u2500\u2500 linkis-datasource-manager //Datasource management module\n\u2502 \u251c\u2500\u2500 common //Data source management common module\n\u2502 \u2514\u2500\u2500 server //Data source management service module\n\u251c\u2500\u2500 linkis-metadata //Module existing in the old version, reserved\n\u251c\u2500\u2500 linkis-metadata-manager //Data Metadata Management Module\n\u2502 \u251c\u2500\u2500 common //Data element management common module\n\u2502 \u251c\u2500\u2500 server //Data element management service module\n\u2502 \u2514\u2500\u2500 service //Supported data sources\n\u2502 \u251c\u2500\u2500 elasticsearch\n\u2502 \u251c\u2500\u2500 hive\n\u2502 \u251c\u2500\u2500 kafka\n\u2502 \u2514\u2500\u2500 mysql\n\n\n")),(0,r.kt)("h3",{id:"14-installation-package-directory-structure"},"1.4 Installation package directory structure"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell",metastring:"script",script:!0},"/lib/linkis-public-enhancements/\n\n\u251c\u2500\u2500 linkis-ps-data-source-manager\n\u251c\u2500\u2500 linkis-ps-metadatamanager\n\u2502 \u2514\u2500\u2500 service\n\u2502 \u251c\u2500\u2500 elasticsearch\n\u2502 \u251c\u2500\u2500 hive\n\u2502 \u251c\u2500\u2500 kafka\n\u2502 \u2514\u2500\u2500 mysql\n")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"wds.linkis.server.mdm.service.lib.dir")," controls the classpath loaded during reflection calls. The default value of the parameter is ",(0,r.kt)("inlineCode",{parentName:"p"},"/lib/linkis-public-enhancements/linkis-ps-metadatamanager/service")),(0,r.kt)("h3",{id:"15-configuration-parameters"},"1.5 Configuration Parameters"),(0,r.kt)("p",null,"See ",(0,r.kt)("a",{parentName:"p",href:"/docs/1.1.0/tuning-and-troubleshooting/configuration#6-datasource-and-metadata-service-configuration-parameters"},"Tuning and Troubleshooting>Parameter List#datasourceConfiguration Parameters")),(0,r.kt)("h3",{id:"16-installation-extra-data-drivers"},"1.6 Installation extra data drivers"),(0,r.kt)("p",null,"1.Some data drivers require to be installed by user's self, because they are possibly not compatible with the Apache license"),(0,r.kt)("p",null,"2.Extra data driver directory: ./lib/linkis-public-enhancements/linkis-ps-publicservice"),(0,r.kt)("p",null,"3.Data drivers list"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Driver Name"),(0,r.kt)("th",{parentName:"tr",align:null},"Driver Version"),(0,r.kt)("th",{parentName:"tr",align:null},"Download Link"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"db2"),(0,r.kt)("td",{parentName:"tr",align:null},"db2jcc4"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("a",{parentName:"td",href:"https://www.ibm.com/support/pages/db2-jdbc-driver-versions-and-downloads"},"https://www.ibm.com/support/pages/db2-jdbc-driver-versions-and-downloads"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"dameng"),(0,r.kt)("td",{parentName:"tr",align:null},"DmJdbcDriver18"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("a",{parentName:"td",href:"https://download.dameng.com/eco/docs/JAVA_Mybatis_lib.zip"},"https://download.dameng.com/eco/docs/JAVA_Mybatis_lib.zip"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"mysql"),(0,r.kt)("td",{parentName:"tr",align:null},"5.1.34"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("a",{parentName:"td",href:"https://repo1.maven.org/maven2/mysql/mysql-connector-java/5.1.34/mysql-connector-java-5.1.34.jar"},"https://repo1.maven.org/maven2/mysql/mysql-connector-java/5.1.34/mysql-connector-java-5.1.34.jar"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"kingbase"),(0,r.kt)("td",{parentName:"tr",align:null},"kingbase8"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("a",{parentName:"td",href:"http://maven.jeecg.org/nexus/content/repositories/jeecg/kingbase/kingbase8/8/kingbase8-8.jar"},"http://maven.jeecg.org/nexus/content/repositories/jeecg/kingbase/kingbase8/8/kingbase8-8.jar"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"greenplum"),(0,r.kt)("td",{parentName:"tr",align:null},"5.1.4"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("a",{parentName:"td",href:"https://network.pivotal.io/products/vmware-tanzu-greenplum#/releases/985537/file_groups/5749"},"https://network.pivotal.io/products/vmware-tanzu-greenplum#/releases/985537/file_groups/5749"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"postgresql"),(0,r.kt)("td",{parentName:"tr",align:null},"42.3.1"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("a",{parentName:"td",href:"https://repo1.maven.org/maven2/org/postgresql/postgresql/42.3.1/postgresql-42.3.1.jar"},"https://repo1.maven.org/maven2/org/postgresql/postgresql/42.3.1/postgresql-42.3.1.jar"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"sqlserver"),(0,r.kt)("td",{parentName:"tr",align:null},"sqlserver2000"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("a",{parentName:"td",href:"https://www.microsoft.com/en-us/download/details.aspx?id=11774"},"https://www.microsoft.com/en-us/download/details.aspx?id=11774"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"oracle"),(0,r.kt)("td",{parentName:"tr",align:null},"11.2.0.3"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("a",{parentName:"td",href:"http://www.datanucleus.org/downloads/maven2/oracle/ojdbc6/11.2.0.3/ojdbc6-11.2.0.3.jar"},"http://www.datanucleus.org/downloads/maven2/oracle/ojdbc6/11.2.0.3/ojdbc6-11.2.0.3.jar"))))),(0,r.kt)("h2",{id:"2-enable-data-source-function"},"2. Enable data source function"),(0,r.kt)("p",null,"In the startup script of linkis, the two services related to the data source (ps-data-source-manager, ps-metadatamanager) will not be started by default.\nIf you want to use the data source service, you can enable it in the following ways:\nModify ",(0,r.kt)("inlineCode",{parentName:"p"},"export ENABLE_METADATA_MANAGER=true")," in ",(0,r.kt)("inlineCode",{parentName:"p"},"$LINKIS_CONF_DIR/linkis-env.sh")," to true.\nWhen the service is started and stopped through linkis-start-all.sh/linkis-stop-all.sh, the data source service will be started and stopped."),(0,r.kt)("p",null,"Check whether the service starts normally through the eureka page"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"datasource eureka",src:a(41746).Z,width:"1820",height:"450"})),(0,r.kt)("admonition",{title:"note",type:"caution"},(0,r.kt)("ul",{parentName:"admonition"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("ol",{parentName:"li"},(0,r.kt)("li",{parentName:"ol"},"Management of linkis The web version needs to be upgraded to version 1.1.0 to use the data source management page function on the linkis console."))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("ol",{parentName:"li",start:2},(0,r.kt)("li",{parentName:"ol"},"At present, there are jar packages of mysql/hive/kafak/elasticsearch in the data source, but the kafak/elasticsearch data source has not been strictly tested, and the complete availability of functions is not guaranteed."))))),(0,r.kt)("h2",{id:"3-use-of-data-sources"},"3. Use of data sources"),(0,r.kt)("p",null,"The use of data sources is divided into three steps:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"step 1. Create data source/configure connection parameters"),(0,r.kt)("li",{parentName:"ul"},"step 2. Publish the data source and select the connection configuration version to use"),(0,r.kt)("li",{parentName:"ul"},"step 3. Data source usage, query metadata information\n, hive/kafka/elasticsearch configuration is associated with the corresponding cluster environment configuration.")),(0,r.kt)("h3",{id:"31-mysql-data-source"},"3.1 Mysql data source"),(0,r.kt)("h4",{id:"311-created-through-the-management-console"},"3.1.1 Created through the management console"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"You can only create configuration data sources, and test whether the data sources can be connected normally, and cannot directly query metadata")),(0,r.kt)("p",null,"Implement a JDBC generic module, and then choose any item mentioned below on the web UI. "),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Data Source"),(0,r.kt)("th",{parentName:"tr",align:null},"Link"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"mysql"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("a",{parentName:"td",href:"https://www.mysql.com"},"https://www.mysql.com"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"oracle"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("a",{parentName:"td",href:"https://www.oracle.com/database/technologies"},"https://www.oracle.com/database/technologies"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"kingbase"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("a",{parentName:"td",href:"https://www.kingbase.com.cn"},"https://www.kingbase.com.cn"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"postgresql"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("a",{parentName:"td",href:"https://www.postgresql.org"},"https://www.postgresql.org"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"sqlserver"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("a",{parentName:"td",href:"https://www.microsoft.com/en-us/sql-server"},"https://www.microsoft.com/en-us/sql-server"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"db2"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("a",{parentName:"td",href:"https://www.ibm.com/products/db2/database"},"https://www.ibm.com/products/db2/database"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"greenplum"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("a",{parentName:"td",href:"https://greenplum.org"},"https://greenplum.org"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"dm"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("a",{parentName:"td",href:"https://dmdatabases.com"},"https://dmdatabases.com"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"doris"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("a",{parentName:"td",href:"https://doris.apache.org"},"https://doris.apache.org"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"clickhouse"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("a",{parentName:"td",href:"https://clickhouse.com"},"https://clickhouse.com"))))),(0,r.kt)("p",null,"Take MySQL as an example:"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Data Source Management > New Data Source > Select MySQL Type")),(0,r.kt)("p",null,"Enter relevant configuration information"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"create mysql",src:a(42885).Z,width:"1889",height:"751"})),(0,r.kt)("p",null,"After the entry is successful, you can pass the connection test to verify whether the connection can be made normally"),(0,r.kt)("admonition",{title:"note",type:"caution"},(0,r.kt)("ul",{parentName:"admonition"},(0,r.kt)("li",{parentName:"ul"},"The system to which the data source created through the management console belongs is Linkis"),(0,r.kt)("li",{parentName:"ul"},"After the creation is successful, it needs to be published (switching and selecting the configuration parameter version when publishing) before it can be used normally"))),(0,r.kt)("p",null,"Publishing of the configuration (using that configuration for the connection to the data source):"),(0,r.kt)("p",null,"Click on the version and then pop up the page to select the appropriate configuration to publish"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"publish",src:a(87525).Z,width:"1635",height:"574"})),(0,r.kt)("h4",{id:"312-using-the-client"},"3.1.2 Using the client"),(0,r.kt)("p",null,"scala code example:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-scala"},'package org.apache.linkis.datasource.client\nimport java.util\nimport java.util.concurrent.TimeUnit\n\nimport org.apache.linkis.common.utils.JsonUtils\nimport org.apache.linkis.datasource.client.impl.{LinkisDataSourceRemoteClient, LinkisMetaDataRemoteClient}\nimport org.apache.linkis.datasource.client.request._\nimport org.apache.linkis.datasource.client.response._\nimport org.apache.linkis.datasourcemanager.common.domain.DataSource\nimport org.apache.linkis.httpclient.dws.authentication.StaticAuthenticationStrategy\nimport org.apache.linkis.httpclient.dws.config.DWSClientConfigBuilder\nimport org.junit.jupiter.api.{Disabled, Test}\n\nobject TestMysqlClient {\n\n  val gatewayUrl = "http://127.0.0.1:9001"\n  val clientConfig = DWSClientConfigBuilder.newBuilder\n    .addServerUrl(gatewayUrl)\n    .connectionTimeout(30000)\n    .discoveryEnabled(false)\n    .discoveryFrequency(1, TimeUnit.MINUTES)\n    .loadbalancerEnabled(true)\n    .maxConnectionSize(1)\n    .retryEnabled(false)\n    .readTimeout(30000)\n    .setAuthenticationStrategy(new StaticAuthenticationStrategy)\n    .setAuthTokenKey("hadoop")\n    .setAuthTokenValue("xxxxx")\n    .setDWSVersion("v1")\n\n  val dataSourceclient = new LinkisDataSourceRemoteClient(clientConfig.build())\n\n  val clientConfig2 = DWSClientConfigBuilder.newBuilder\n    .addServerUrl(gatewayUrl)\n    .connectionTimeout(30000)\n    .discoveryEnabled(false)\n    .discoveryFrequency(1, TimeUnit.MINUTES)\n    .loadbalancerEnabled(true)\n    .maxConnectionSize(1)\n    .retryEnabled(false)\n    .readTimeout(30000)\n    .setAuthenticationStrategy(new StaticAuthenticationStrategy)\n    .setAuthTokenKey("hadoop")\n    .setAuthTokenValue("xxxxx")\n    .setDWSVersion("v1")\n\n  val metaDataClient = new LinkisMetaDataRemoteClient(clientConfig2.build())\n\n  @Test\n  @Disabled\n  def testCreateDataSourceMysql: Unit = {\n    val user = "hadoop"\n    val system = "Linkis"\n\n    //create data source\n    val dataSource = new DataSource();\n    val dataSourceName = "for-mysql-test"\n    dataSource.setDataSourceName(dataSourceName)\n    dataSource.setDataSourceDesc("this is for mysql test")\n    dataSource.setCreateSystem(system)\n    dataSource.setDataSourceTypeId(1L)\n\n    val map = JsonUtils.jackson.readValue(JsonUtils.jackson.writeValueAsString(dataSource), new util.HashMap[String, Any]().getClass)\n    val createDataSourceAction: CreateDataSourceAction = CreateDataSourceAction.builder()\n      .setUser(user)\n      .addRequestPayloads(map)\n      .build()\n    val createDataSourceResult: CreateDataSourceResult = dataSourceclient.createDataSource(createDataSourceAction)\n    val dataSourceId = createDataSourceResult.getInsertId\n\n\n    // set connection parameters\n    val params = new util.HashMap[String, Any]\n\n    val connectParams = new util.HashMap[String, Any]\n    connectParams.put("host", "127.0.0.1")\n    connectParams.put("port", "36000")\n    connectParams.put("username", "db username")\n    connectParams.put("password", "db password")\n\n    params.put("connectParams", connectParams)\n    params.put("comment", "init")\n\n    val updateParameterAction: UpdateDataSourceParameterAction = UpdateDataSourceParameterAction.builder()\n      .setUser(user)\n      .setDataSourceId(dataSourceId)\n      .addRequestPayloads(params)\n      .build()\n    val updateParameterResult: UpdateDataSourceParameterResult = dataSourceclient.updateDataSourceParameter(updateParameterAction)\n\n    val version: Long = updateParameterResult.getVersion\n\n    //publish configuration version\n    dataSourceclient.publishDataSourceVersion(\n      PublishDataSourceVersionAction.builder()\n        .setDataSourceId(dataSourceId)\n        .setUser(user)\n        .setVersion(version)\n        .build())\n\n     // use example\n    val metadataGetDatabasesAction: MetadataGetDatabasesAction = MetadataGetDatabasesAction.builder()\n      .setUser(user)\n      .setDataSourceName(dataSourceName)\n      .setSystem(system)\n      .build()\n    val metadataGetDatabasesResult: MetadataGetDatabasesResult = metaDataClient.getDatabases(metadataGetDatabasesAction)\n\n    val metadataGetTablesAction: MetadataGetTablesAction = MetadataGetTablesAction.builder()\n      .setUser(user)\n      .setDataSourceName(dataSourceName)\n      .setDatabase("linkis")\n      .setSystem(system)\n      .build()\n    val metadataGetTablesResult: MetadataGetTablesResult = metaDataClient.getTables(metadataGetTablesAction)\n\n    val metadataGetColumnsAction = MetadataGetColumnsAction.builder()\n      .setUser(user)\n      .setDataSourceName(dataSourceName)\n      .setDatabase("linkis")\n      .setSystem(system)\n      .setTable("linkis_datasource")\n      .build()\n    val metadataGetColumnsResult: MetadataGetColumnsResult = metaDataClient.getColumns(metadataGetColumnsAction)\n    \n  }\n}\n\n')),(0,r.kt)("h4",{id:"313-jdbc-engineconn-supported-by-linkis"},"3.1.3 JDBC EngineConn supported by Linkis"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"MySQL"),(0,r.kt)("li",{parentName:"ul"},"Oracle"),(0,r.kt)("li",{parentName:"ul"},"KingBase"),(0,r.kt)("li",{parentName:"ul"},"PostgreSQL"),(0,r.kt)("li",{parentName:"ul"},"SQLServer"),(0,r.kt)("li",{parentName:"ul"},"DB2"),(0,r.kt)("li",{parentName:"ul"},"Greenplum"),(0,r.kt)("li",{parentName:"ul"},"DM"),(0,r.kt)("li",{parentName:"ul"},"Doris"),(0,r.kt)("li",{parentName:"ul"},"ClickHouse"),(0,r.kt)("li",{parentName:"ul"},"TiDB"),(0,r.kt)("li",{parentName:"ul"},"Starrocks"),(0,r.kt)("li",{parentName:"ul"},"Gaussdb"),(0,r.kt)("li",{parentName:"ul"},"OceanBase")),(0,r.kt)("h3",{id:"32-hive-data-source"},"3.2 Hive data source"),(0,r.kt)("h4",{id:"321-created-through-the-management-console"},"3.2.1 Created through the management console"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"You can only create configuration data sources, and test whether the data sources can be connected normally, and cannot directly query metadata")),(0,r.kt)("p",null,"First need to configure the cluster environment information\nTable ",(0,r.kt)("inlineCode",{parentName:"p"},"linkis_ps_dm_datasource_env")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-roomsql"},'INSERT INTO `linkis_ps_dm_datasource_env`\n(`env_name`, `env_desc`, `datasource_type_id`, `parameter`, `create_user`, `modify_user`)\nVALUES\n(\'testEnv\', \'Test Environment\', 4,\n\'{\\r\\n "uris": "thrift://clustername:9083",\\r\\n "keytab": "4dd408ad-a2f9-4501-83b3-139290977ca2",\\r\\n "principle": "hadoop @WEBANK.COM",\\r\\n "hadoopConf":{"hive.metastore.execute.setugi":"true"}\\r\\n}\',\n\'user\',\'user\');\n')),(0,r.kt)("p",null,"The primary key id is used as the envId. When establishing a connection, you need to use this envId parameter to obtain information about the cluster configuration.\nExplanation of configuration fields:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'{\n    "uris": "thrift://clustername:9083", # Mandatory If kerberos authentication is not enabled, the following [keytab][principle] parameters can be empty\n    "keytab": "bml resource id", //keytab stores the resourceId in the material library, and currently needs to be manually uploaded through the http interface.\n    "principle": "hadoop@WEBANK.COM" //Authentication principle\n    "hadoopConf":{} //Additional connection parameters are optional\n}\n')),(0,r.kt)("p",null,"The resourceId acquisition method of keytab, the basic data management function is still under planning, and can be obtained through the http interface request\nreference example"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell",metastring:"script",script:!0},'curl --form "file=@file path" \\\n--form system=subsystem name \\\n-H "Token-Code: authentication token" \\\n-H "Token-User: authentication user name" \\\nhttp://linkis-gatewayip:port/api/rest_j/v1/bml/upload\n\nExample:\ncurl --form "file=@/appcom/keytab/hadoop.keytab" \\\n--form system=ABCD \\\n-H "Token-Code:QML-AUTH" \\\n-H "Token-User:hadoop" \\\nhttp://127.0.0.1:9001/api/rest_j/v1/bml/upload\n\nThe resourceId in the request result is the corresponding `bml resource id` value\n{"method":"/bml/upload","status":0,"message":"The task of submitting and uploading resources was successful","data":{"resourceId": "6e4e54fc-cc97-4d0d-8d5e-a311129ec84e","version":"v000001","taskId":35}}\n')),(0,r.kt)("p",null,"Create on the web:"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"create_hive",src:a(37334).Z,width:"1624",height:"554"})),(0,r.kt)("h4",{id:"322-using-the-client"},"3.2.2 Using the client"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-scala"},'package org.apache.linkis.datasource.client\n\nimport java.util\nimport java.util.concurrent.TimeUnit\n\nimport org.apache.linkis.common.utils.JsonUtils\nimport org.apache.linkis.datasource.client.impl.{LinkisDataSourceRemoteClient, LinkisMetaDataRemoteClient}\nimport org.apache.linkis.datasource.client.request._\nimport org.apache.linkis.datasource.client.response._\nimport org.apache.linkis.datasourcemanager.common.domain.DataSource\nimport org.apache.linkis.httpclient.dws.authentication.StaticAuthenticationStrategy\nimport org.apache.linkis.httpclient.dws.config.DWSClientConfigBuilder\nimport org.junit.jupiter.api.{Disabled, Test}\n\nobject TestHiveClient {\n  val gatewayUrl = "http://127.0.0.1:9001"\n  val clientConfig = DWSClientConfigBuilder.newBuilder\n    .addServerUrl(gatewayUrl)\n    .connectionTimeout(30000)\n    .discoveryEnabled(false)\n    .discoveryFrequency(1, TimeUnit.MINUTES)\n    .loadbalancerEnabled(true)\n    .maxConnectionSize(1)\n    .retryEnabled(false)\n    .readTimeout(30000)\n    .setAuthenticationStrategy(new StaticAuthenticationStrategy)\n    .setAuthTokenKey("hadoop")\n    .setAuthTokenValue("xxxxx")\n    .setDWSVersion("v1")\n\n  val dataSourceclient = new LinkisDataSourceRemoteClient(clientConfig.build())\n\n  val clientConfig2 = DWSClientConfigBuilder.newBuilder\n    .addServerUrl(gatewayUrl)\n    .connectionTimeout(30000)\n    .discoveryEnabled(false)\n    .discoveryFrequency(1, TimeUnit.MINUTES)\n    .loadbalancerEnabled(true)\n    .maxConnectionSize(1)\n    .retryEnabled(false)\n    .readTimeout(30000)\n    .setAuthenticationStrategy(new StaticAuthenticationStrategy)\n    .setAuthTokenKey("hadoop")\n    .setAuthTokenValue("xxxxx")\n    .setDWSVersion("v1")\n\n  val metaDataClient = new LinkisMetaDataRemoteClient(clientConfig2.build())\n\n\n  @Test\n  @Disabled\n  def testCreateDataSourceMysql: Unit = {\n    val user = "hadoop"\n    val system = "Linkis"\n\n   //create data source\n    val dataSource = new DataSource();\n    val dataSourceName = "for-hive-test"\n    dataSource.setDataSourceName(dataSourceName)\n    dataSource.setDataSourceDesc("this is for hive test")\n    dataSource.setCreateSystem(system)\n    dataSource.setDataSourceTypeId(4L)\n\n    val map = JsonUtils.jackson.readValue(JsonUtils.jackson.writeValueAsString(dataSource), new util.HashMap[String, Any]().getClass)\n    val createDataSourceAction: CreateDataSourceAction = CreateDataSourceAction.builder()\n      .setUser(user)\n      .addRequestPayloads(map)\n      .build()\n    val createDataSourceResult: CreateDataSourceResult = dataSourceclient.createDataSource(createDataSourceAction)\n    val dataSourceId = createDataSourceResult.getInsertId\n\n     // set connection parameters\n    val params = new util.HashMap[String, Any]\n    val connectParams = new util.HashMap[String, Any]\n    connectParams.put("envId", "3")\n    params.put("connectParams", connectParams)\n    params.put("comment", "init")\n\n    val updateParameterAction: UpdateDataSourceParameterAction = UpdateDataSourceParameterAction.builder()\n      .setUser(user)\n      .setDataSourceId(dataSourceId)\n      .addRequestPayloads(params)\n      .build()\n    val updateParameterResult: UpdateDataSourceParameterResult = dataSourceclient.updateDataSourceParameter(updateParameterAction)\n\n    val version: Long = updateParameterResult.getVersion\n\n    //publish configuration version\n    dataSourceclient.publishDataSourceVersion(\n      PublishDataSourceVersionAction.builder()\n        .setDataSourceId(dataSourceId)\n        .setUser(user)\n        .setVersion(version)\n        .build())\n\n    // use example\n    val metadataGetDatabasesAction: MetadataGetDatabasesAction = MetadataGetDatabasesAction.builder()\n      .setUser(user)\n      .setDataSourceName(dataSourceName)\n      .setSystem(system)\n      .build()\n    val metadataGetDatabasesResult: MetadataGetDatabasesResult = metaDataClient.getDatabases(metadataGetDatabasesAction)\n\n    val metadataGetTablesAction: MetadataGetTablesAction = MetadataGetTablesAction.builder()\n      .setUser(user)\n      .setDataSourceName(dataSourceName)\n      .setDatabase("linkis_test_ind")\n      .setSystem(system)\n      .build()\n    val metadataGetTablesResult: MetadataGetTablesResult = metaDataClient.getTables(metadataGetTablesAction)\n\n\n\n    val metadataGetColumnsAction = MetadataGetColumnsAction.builder()\n      .setUser(user)\n      .setDataSourceName(dataSourceName)\n      .setDatabase("linkis_test_ind")\n      .setSystem(system)\n      .setTable("test")\n      .build()\n    val metadataGetColumnsResult: MetadataGetColumnsResult = metaDataClient.getColumns(metadataGetColumnsAction)\n\n  }\n}\n')))}m.isMDXComponent=!0},37334:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/create_hive-6b7da346506ec10f1ebd68ed37ff4e12.png"},42885:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/create_mysql-748ae7a51622be09651e31630bf6403e.png"},9513:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/datasource-33466f8154b90ce8c308f80af54fed9d.png"},41746:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/eureka-6c655a155cf632afe0003ad92f7cddd7.png"},21470:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/metadata-00c6c1e49a4eafa8a2496b9a08917758.png"},87525:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/publish_version-74eb63ec4aedd2b4a28ff93fbb5e567d.png"}}]);